[tox]
envlist =
	py36-django{22,30,31}
	py37-django{22,30,31}
	py38-django{22,30,31,32}
	py{39,310}-django{40,41,42}
	# TODO: reinstate running on postgres: py39-django{40}-postgres
	docs

[testenv]
setenv =
	PYTHONWARNINGS = all
	postgres: DEFAULT_DATABASE = postgres:///default
	postgres: SECONDARY_DATABASE = postgres:///secondary
deps =
	coverage
	dj-database-url
	django22: Django ~= 2.2
	django30: Django ~= 3.0
	django31: Django ~= 3.1
	django40: Django ~= 4.0
	django41: Django ~= 4.1
	django42: Django ~= 4.2
	djangomain: https://github.com/django/django/archive/main.tar.gz
	postgres: psycopg2
commands =
	coverage run --source polymorphic runtests.py

[testenv:docs]
deps =
	Sphinx
	sphinx_rtd_theme
	-r{toxinidir}/docs/_ext/djangodummy/requirements.txt
changedir = docs
commands = sphinx-build -W -b html -d {envtmpdir}/doctrees . {envtmpdir}/html

[gh-actions]
python =
    3.6: py36
    3.7: py37
    3.8: py38
    3.9: py39
    3.10: py310
    3.11: py311
